%% igcomment.sty, a patched version of igcomment.sty :
%% $Id: igcomment.tex 316 2010-05-14 21:32:34Z herbert $
%%
%% COPYRIGHT 1993/2010, by Timothy Van Zandt, tvz@Princeton.EDU
%% COPYRIGHT 2010, by Herbert Voss, hvoss@tug.org
%%
%% DESCRIPTION:
%%
%% This program can be redistributed and/or modified under the terms
%% of the LaTeX Project Public License Distributed from CTAN archives
%% in directory macros/latex/base/lppl.txt.
%%
\def\fileversion{1.3}
\def\filedate{10/05/14}
%%
\@ifundefined{igcomment@@@}{}{\endinput}
\typeout{Style-Option: `igcomment' v\fileversion \space <\filedate> (tvz) }
\newif\ifigincluded
\def\newigcomment{\@ifnextchar [{\@newigcommentwitharg}{\@newigcomment}}
\def\@newigcomment#1{%
  \expandafter\def\csname #1\endcsname##1{\@igcomment{#1}{##1}}}%
\def\@newigcommentwitharg[#1]#2{%
  \expandafter\def\csname #2\endcsname{\@igcomment{#2}{#1}}}
\newigcomment{igcomment}
\def\envirsep{\par}
\def\rescanfile#1{\def\@rescanfile{#1}}
\rescanfile{\jobname.tmp}
\def\norescanfile{\let\@rescanfile\relax}
\def\@nofloat#1{\hrule height\z@\nobreak\vfill\vbox\bgroup\def\@captype{#1}}
\def\end@nofloat{\egroup\nobreak\vfill\nobreak\hrule height\z@\medbreak}
\def\nofloat#1{\@for\@tempa:=#1\do{\@namedef{#1}{\@nofloat{#1}}%
  \@namedef{end#1}{\end@nofloat}}}
\def\ig@makeother#1{%
  \ifnum\the\catcode`#1=0\catcode`#112%
  \else \ifnum\the\catcode`#1=1\catcode`#112%
    \else \ifnum\the\catcode`#1=2\catcode`#112%
      \else \ifnum\the\catcode`#1=6\catcode`#112%
  \fi\fi\fi\fi\relax}
\newwrite\tokout
\newread\tokin
\def\rescan#1{%
  \ifx\@rescanfile\relax\else
    \ifx\@rescanfile\@empty #1{}\else
      \immediate\openout\tokout=\@rescanfile
      \immediate\write\tokout{{\the#1}\relax}%
      \immediate\closeout\tokout
      \openin\tokin=\@rescanfile
      \read\tokin to\@tempd
      \closein\tokin
      \expandafter#1\@tempd%
  \fi\fi}
\def\@igcomment#1#2{%
  \ifx\@preamblecmds\@notprerr
    \def\ig@csname{#1}%
    \edef\ig@envirlist{#2}%
    \ifx\ig@envirlist\@empty \@bsphack \else
      \begingroup
      \def\@envirsep{}%
      \@ifundefined{normal@begin}{\let\normal@begin\begin}{}%iginclude
      \@ifundefined{normal@end}{\let\normal@end\end}{}%
      \def\begin##1{\do@begin{##1}\normal@begin{##1}}%
      \def\end##1{\normal@end{##1}\do@end}%
      \def\do@begin##1{\@ifundefined{##1}{}{\def\do@end{}}}%
      \let\do@end\ig@begin
    \fi
    \let\next\ig@begin
  \else
    \expandafter\@temptokena\expandafter{\document\@igcomment{@@@}{#2}}%
    \edef\document{\the\@temptokena}%
    \let\next\relax
  \fi
  \next}
\def\end@igcomment{\ifx\ig@envirlist\@empty \@esphack \else \endgroup \fi}%
\def\ig@begin{%
  \begingroup
    \let\do\ig@makeother
    \dospecials
    \ifx\igcommentchar\@empty\else
      \expandafter\catcode\expandafter`\igcommentchar=14
    \fi
    \catcode`\^^M\active
    \igcomment@}
\def\igcommentchar{\%}
\begingroup
\catcode`\!=12
\catcode`\[=12
\catcode`\]=12 
\catcode`\"=12
\lccode`\!=`\\
\lccode`\[=`\{
\lccode`\]=`\}
\lccode`\"=`\%
\catcode`\~=\active
\lccode`\~=`\^^M
\lowercase{
  \gdef\igcomment@#1~{\igcomment@@#1\@nnil!\@nil}
  \gdef\igcomment@@#1!{\igcomment@@@}
  \gdef\igcomment@@@#1\@nil{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty
      \let\next\igcomment@
    \else
      \def\next{\igcomment@@#1\@nil}%
      \@testtrue
      \ig@checkbegin#1\relax begin[]\relax\relax
      \if@test
        \ig@checkend#1\relax end[]\relax\relax
        \if@test
          \ig@checkinput#1\relax input[]\relax\relax
          \if@test
            \ig@checkinclude#1\relax include[]\relax\relax
            \if@test
            \ig@checkigincludeweb#1\relax igincludeweb[]\relax\relax
            \if@test
              \ig@checkendinput#1\relax endinputss\relax\relax 
    \fi\fi\fi\fi\fi\fi
    \next}
  \gdef\ig@checkbegin#1begin[#2]#3\relax#4\relax{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty
      \def\@tempa{#2}%
      \@for\@tempb:=\ig@envirlist\do{%
        \ifx\@tempa\@tempb\def\next{\ig@end{#2}#3\@nil}\fi}%
    \fi}
  \gdef\ig@checkend#1end[#2]#3\relax#4\relax{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty
      \@testfalse
      \def\@tempa{#2}\def\@tempb{document}%
      \ifx\@tempa\@tempb
        \def\next{%
          \ifigincluded
            \def\next{\global\igincludedfalse\endinput}%
          \else
            \def\next{\endgroup\end@igcomment\end{document}}%
          \fi%
        \next}%
      \else
        \ifx\@tempa\ig@csname
          \def\next{\end@@igcomment{#2}#3\@nil}%
    \fi\fi\fi}
  \gdef\ig@checkinput#1input[#2]#3\relax#4\relax{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty
      \def\next{\expandafter\igcomment@\@@input #2 \igcomment@@#3\@nil}%
      \@testfalse
    \fi}
    \gdef\ig@checkigincludeweb#1igincludeweb[#2]#3\relax#4\relax{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty
      \def\next{%
        \global\let\ig@savedinput\@@input
        \def\@@input{%
          \global\let\@@input\ig@savedinput
          \expandafter\igcomment@\@@input}%
        \igincludeweb{#2}%#3\@nil%
        \global\let\@@input\ig@savedinput
        \igcomment@@#3\@nil}%
      \@testfalse
    \fi}
  \gdef\ig@checkendinput#1endinput#2#3\relax#4\relax{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty\ifcat\noexpand#2a\relax\else
      \let\next\endinput
    \fi\fi}
  \gdef\ig@checkinclude#1include[#2]#3\relax#4\relax{%
    \def\@tempa{#1}%
    \ifx\@tempa\@empty
      \def\next{%
        \global\let\ig@savedinput\@@input
        \def\@@input{%
          \global\let\@@input\ig@savedinput
          \expandafter\igcomment@\@@input}%
        \include{#2}%
        \global\let\@@input\ig@savedinput
        \igcomment@@#3\@nil}%
      \@testfalse
    \fi}
  \gdef\end@@igcomment#1#2\@nnil!\@nil{%
    \endgroup
    \toks@{#2 }\rescan{\toks@}%
    \edef\next{\noexpand\end@igcomment\noexpand\end{#1}\the\toks@}%
    \next}%
  \gdef\ig@end#1#2\@nnil!\@nil{%
    \endgroup
    \@envirsep \let\@envirsep\envirsep
    \toks@{#2 }\rescan{\toks@}%
    \edef\next{\noexpand\normal@begin{#1}\the\toks@}%
    \next}%
  \gdef\ig@igincludeweb#1#2\@nnil!\@nil{%
    \endgroup
    \toks@{#2 }\rescan{\toks@}%
    \edef\next{\noexpand\igincludeweb{#1}\the\toks@}%
    \next}%
  }%  END OF LOWERCASE
\endgroup
\endinput
%%
%% End of file `igcomment.sty'.
