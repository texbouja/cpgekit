\def\filedate{2023/22/12}
\def\fileversion{v0.1alpha}
\def\fileauthor{Sadik Boujaida}

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{igcours}[\filedate\space\fileversion]

\RequirePackage{igmath}
\RequirePackage{tcolorbox}
\tcbuselibrary{skins,breakable,theorems,xparse,hooks}
\usetikzlibrary{calc}

\tcbset{%
	breakable,
	lines before break=1,
	height fixed for=first and middle,
	fonttitle=\sffamily\scshape\bfseries\footnotesize\vphantom{(},
	description font=\sffamily\scshape\footnotesize\vphantom{(},
	titlerule=0pt,
	colback=bgcol,colupper=fgcol
}
\AfterEndPreamble{%
	\ifdraft
		\tcbset{every box/.style={
				reset,
				breakable,
				lines before break=1,
				height fixed for=first and middle,
				fonttitle=\sffamily\scshape\footnotesize,
				description font=\sffamily\scshape\footnotesize,
				titlerule=0pt,
				coltitle=fgcol
		}}
	\fi
}
%\def\tcbstartdraftmode{\let\tcb@afteroptions@hook=\tcb@draftmode\tcb@isindrafttrue}

\def\cbf#1{\textcolor{tcbcolbacktitle}{\bfseries #1}}
\newcommand\igdisc[1][tcbcolbacktitle]{\tikz\fill[#1] (0,.5ex) circle (.5ex);}
\tcbset{%
	font app/.code 2 args={\csappto{kvtcb@font#1}{#2}},
	font reset/.code 2 args={\csdef{kvtcb@font#1}{#2}}
}

\dimdef\lrmargin@left{\z@}
\dimdef\lrmargin@right{\z@}
\igset{mini/.is family, mini/.cd,
	left margin/.code={\dimdef{\lrmargin@left}{#1}},
	right margin/.code={\dimdef{\lrmargin@right}{#1}},
	font/.code={\def\MINI@font{#1}}
}
\igset{simple deco/.code={%
			\igdeco{simple}{\simple@label@font#1}%
			\let\deco@lrmargin\deco@simple},
	   simple label font/.code={\def\simple@label@font{#1\vphantom{(}}},
	   simple label font=\sffamily\footnotesize,
	   simple deco={\fboxrule0pt\fboxsep2pt%
				\fcolorbox{tcbcolbacktitle}{tcbcolbacktitle}{#1}}
}
\igset{simple deco=\fbox{#1}}
\igset{mini/.cd,
	left margin=.6cm,
	right margin=0pt,
	font=\sffamily\small
	}
\DeclareDocumentEnvironment{MINI}{O{} D(){}}{%
		\igset{mini/.cd,#1}%
		\begin{lrmargin}[\MakeLowercase{\scshape#2}]{\lrmargin@left}{\lrmargin@right}%
		\MINI@font\footnotesize%
		\leftmarginiii0pt%
	}{\end{lrmargin}}

\def\mini{\begin{MINI}}
\def\endmini{\end{MINI}}
\def\nb{\mini(N.B.)}
\let\endnb\endmini
\def\dem{\mini(dem)}
\let\enddem\endmini



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% Mise en place des differents types de theoremes %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifexo@type
\newif\iftheo@type
\newif\ifdef@type
\newif\ifrem@type
\newif\ifproof@type
\def\unset@type{%
	\global\exo@typefalse\theo@typefalse\def@typefalse\rem@typefalse\proof@typefalse}
\igset{theorem type/.is choice,
	 theorem type/exercise/.code={\rem@typefalse},
	 theorem type/theorem/.code={\rem@typefalse},
	 theorem type/definition/.code={\rem@typefalse},
	 theorem type/remark/.code={\rem@typetrue},
	 theorem type/proof/.code={\rem@typetrue}
 }
\tcbset{theorem type/.is choice,
	 theorem type/exercise/.code={\exo@typetrue},
	 theorem type/theorem/.code={\theo@typetrue},
	 theorem type/definition/.code={\def@typetrue},
	 theorem type/remark/.code={\rem@typetrue},
	 theorem type/proof/.code={\proof@typetrue},
 }
\tcbset{new/within chapter or section/.code=%
		{\ifchapter@in@class
			\tcbset{new/number within=chapter}
		\else
			\tcbset{new/number within=section}
		\fi}
}

\igset{theorems/.is family, theorems,
	theorem style/.code=%
		\tcbset{theorem style/.style={%
			colbacktitle=warmcol,#1,current counter=\thetcbcounter}},
	definition style/.code=%
		\tcbset{definition style/.style={%
			colbacktitle=coldcol,#1,current counter=\thetcbcounter}},
	exercise style/.code=%
		\tcbset{exercise style/.style={#1}},
	remark style/.code=%
		\tcbset{remark style/.style={%
			colbacktitle=neutralcol,#1,current counter=\thetcbcounter}},
	proof style/.code=\tcbset{proof style/.style={#1}}
	}
\def\igtheoremstyle{\pgfqkeys{/ig/theorems}}
\def\igappendtheoremstyle#1#2{\tcbset{#1 style/.append style={#2}}}
\def\igtcbset{\pgfqkeys{/tcb}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%% Gestion des demos et des solutions %%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%% cles d'enregistrement dans le fichier records
\let\solution\relax
\let\proof\relax
\newif\ifhas@solu
\newif\ifhas@prv
\def\out@dir{out} 
\def\aux@dir{aux}
\newcounter{file@number}
\setcounter{file@number}{1}
\tcbset{%
		solu@rec/.style={record={%
			\string\solu{\thefile@number}%
				{\ig@label@prefix}%
				{\thetcbcounter}%
				{\ig@theorem@name}%
				{\igdu@theorem@name}%
				{\aux@dir/exe-\thetcbcounter.tex}%
				}},
		preuve@rec/.style={record={%
			\string\preuve{\thefile@number}%
				{\ig@label@prefix}%
				{\thetcbcounter}%
				{\ig@theorem@name}%
				{\igdu@theorem@name}%
				{\aux@dir/prv-\thetcbcounter.tex}%
				}},
       with@solu/.style={%
        	lowerbox=ignored,
        	solution@link,
        	before upper pre={\global\has@solutrue\let\solution\tcblower},
        	hypertarget={\ig@label@prefix:\thetcbcounter},
        	savelowerto=\aux@dir/exe-\thetcbcounter.tex,
        	solu@rec
        	},
       with@preuve/.style={%
        	lowerbox=ignored,
        	proof@link,
        	before upper pre={\global\has@prvtrue\let\proof\tcblower},
        	hypertarget={\ig@label@prefix:\thetcbcounter},
        	savelowerto=\aux@dir/prv-\thetcbcounter.tex,
        	preuve@rec
        	},
}
\tcbset{%
	proof or solution/.code={%
	 	\ifexo@type\tcbset{with@solu}\fi%
		\iftheo@type\tcbset{with@preuve}\fi}
	}


%%% cles de creation des liens sur l'ennonce
\tcbset{@demolink/.style 2 args={%
	bottom=12pt,
	underlay unbroken and last={\node (link) at ([xshift=-6pt]frame.south east) 
		[text=linkcol,
		 draw=linkcol,
		 fill=tcbcolback!95!black,
		 inner ysep=2pt, inner xsep=6pt,
		 font=\fontsize{7}{7}\selectfont\scshape\vphantom{(}, 
		 anchor=south east, 
		 rounded corners=6pt,
		 yshift=2pt
		] 
		{#2 \thetcbcounter, page \pageref*{#1@\thetcbcounter}};},
		hyperlink node={#1@\thetcbcounter}{link}
	},
	proof@link/.code=\ifprv@trigger\tcbset{@demolink={proof}{d\'emonstration}}\fi,
	solution@link/.code=\ifsol@trigger\tcbset{@demolink={solution}{solution}}\fi,
}
%%%%% cles logiques d'insertion ou non de solution 
\tikzset{proof title style/.style={rounded corners=7pt,
		 inner xsep=8pt,
		 inner ysep=2pt,
		 bottom color=tcbcolback!90!black,}}	
%% boites tcolorbox pour demonstrations et solutions
\NewTotalTColorBox{\solu@box}{mmmmm}{%
  proof style,
  title={\tikz\node [proof title style]
  			{\hyperlink{#1:#2}{\vphantom{(}Solution #4~#2}};},  
  hypertarget={solution@#2},
  phantomlabel={solution@#2}
 }{\input{#5}}
\def\solu@#1{\ifnum\c@file@number=#1\relax\expandafter\solu@box\fi}
\def\solu@@#1{\solu@box}
\NewTotalTColorBox{\preuve@box}{mmmmm}{%
  proof style,
  current counter=#2,
  title={\tikz\node [proof title style]
  			{\hyperlink{#1:#2}{\vphantom{(}D\'emonstration #4~#2}};},
  hypertarget={proof@#2},
  phantomlabel={proof@#2}
 }{\input{#5}}
\def\preuve@#1{\ifnum\c@file@number=#1\relax\expandafter\preuve@box\fi}
\def\preuve@@#1{\preuve@box}
\def\preuve#1#2#3#4#5#6{}
\def\solu#1#2#3#4#5#6{}

\tcbset{no solution/.style={no recording,after upper=}}

\newif\ifsol@forthisfile\sol@forthisfiletrue
\newif\ifsol@trigger
\newif\ifprv@trigger
\newif\ifsol@active

\igset{solutions/.is family, solutions,
	solution/.code=\csuse{sol@trigger#1},
	proof/.code=\csuse{prv@trigger#1},
	solution/.default=true,
	proof/.default=true,
	proof and solution/.style={proof,solution},
	solution and proof/.style={proof,solution},
	solution title/.code 2 args=\def\sol@section{\csuse{#1}{#2}},
	solution title/.default={section}{Solutions des exercices},
	proof title/.code 2 args=\def\prv@section{\csuse{#1}{#2}},
	proof title/.default={section}{D\'emonstrations des th\'eor\`emes},
	proof, solution, solution title, proof title
	}
\def\iginclude{\@ifstar\ig@include@\ig@include}
\def\ig@include@{\ig@include[proof=false,solution=false]}
\def\ig@curbasefilename{\jobname}
\DeclareDocumentCommand\ig@include{t{+} O{} m}{%%
\begingroup%
	\def\ig@curbasefilename{#3}%
	\IfBooleanTF{#1}{\sol@forthisfilefalse}{}%
    \IfValueTF{#2}{\igset{solutions/.cd,#2}}{}%
    \ifsol@active\else\startrecording\fi%
	\input{#3}%
	\ifsol@forthisfile%
		\stoprecording%
		\ifprv@trigger\ifhas@prv%
			\eject\ifodd\thepage\null\eject\fi
			\prv@section%
			\typoutdemonstrations*%
		\fi\fi%
		\ifsol@trigger\ifhas@solu
			\eject\null\ifodd\c@page\else\eject\fi
			\sol@section
			\typoutsolutions*
		\fi\fi
	\fi%
\endgroup%
\has@solufalse\has@prvfalse}
\AtEndDocument{\ifsol@active\stoprecording\fi}
\DeclareDocumentCommand{\typoutsolutions}{s O{\tcb@record@file}}{%
  \begingroup%
  \IfBooleanTF{#1}{\def\solu{\solu@}}{\def\solu{\solu@@}}%
  %\show\solu
  \IfFileExists{#2}{\input{#2}}%
  	{\tcb@error{fichier record `#2' non trouv\'e}{The record file `#2' was not found}}%
  \endgroup%
}
\DeclareDocumentCommand{\typoutdemonstrations}{s O{\tcb@record@file}}{%
  \begingroup%
  \IfBooleanTF{#1}{\def\preuve{\preuve@}}{\def\preuve{\preuve@@}}%
  %\show\preuve
  \IfFileExists{#2}{\input{#2}}%
  	{\tcb@error{record file `#2' not found}{The record file `#2' was not found}}%
  \endgroup%
}

%%% raccourci pour activer les sorties vers fichier record et les fichiers des sol
\def\startrecording{\tcbstartrecording\relax\global\sol@activetrue}
\def\stoprecording{\tcbstoprecording\relax\global\sol@activefalse}
\let\Exercices\startrecording
\let\endExercices\stoprecording

\tcbset{no@countertoolargemessage/.code={\let\@ctrerr\relax},
	no@countertoolargemessage
	}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% Définition des environnements pour théroremes %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% macros et cles principales de creation de theorem

\def\kvtbc@titlewho{\ifdefempty{\kvtcb@title}{\tcbtitletext}{\kvtcb@title}}
\tcbset{title style if break/.style={%%
	title after break={\MakeLowercase{\kvtbc@titlewho}~(suite)},
	extras title after break={%
		halign title=right,
		coltitle=tcbcolbacktitle,
		font app={title}{\fontsize{7}{7}\mdseries\itshape}
		},
	extras middle and last={colbacktitle=tcbcolback},
	bottomrule=1pt, 
	bottomrule at break=0pt,
	toprule at break=0pt,
	titlerule=0pt
}}

\tcbset{%
		@labprefix/.store in=\ig@label@prefix, 
		@theoname/.store in=\ig@theorem@name,
		du@theoname/.store in=\igdu@theorem@name,
		@demoname/.store in=\ig@demo@name
	}
\tikzset{description path style/.style={%
				fill=tcbcolbacktitle,
				draw=none,
				rounded corners=5pt,
				font=\fontsize{10}{8}\selectfont\vphantom{(},
				text=tcbcoltitle,
				#1}}
\tcbset{description path/.style={%
	overlay unbroken and first={%
    	\path let \p1=(title.north east), \p2=([xshift=-12pt]frame.north east) in
			node [%
        		anchor=west,
				xshift=2pt,inner ysep=1pt,
				text width=\x2-\x1,
				description path style
				] 
			at (title.east) {#1};
  		}
}}
\tcbset{important/.style={%
	colbacktitle=importantcol,
	bottom=10pt,
	underlay unbroken and last={\node at (frame.south west) 
		[text=tcbcolbacktitle, 
		 font=\fontsize{7}{8}\selectfont, 
		 anchor=south west, 
		 yshift=2pt
		] 
		{\ifexo@type exercice \else r\'esultat\fi   important};},
		#1
}}

%%% Environnement butineur : tous les environnement 
%%% de theoreme l'utilisent en interne
\def\tcb@theo@form@namenumber#1#2{\hbox{#1~#2}}
\def\tcb@theo@form@numbername#1#2{\hbox{#2~#1}}
\def\tcb@theo@form@name#1#2{\hbox{#1}}
\tcbset{%
	theorem name and number/.code={\let\tcb@theo@form=\tcb@theo@form@namenumber},
	theorem number and name/.code={\let\tcb@theo@form=\tcb@theo@form@numbername},
	theorem name/.code={\let\tcb@theo@form=\tcb@theo@form@name},
}
\def\ig@theo@label#1#2{\label{#1:#2}}
\NewDocumentCommand{\ig@new@tcbtheorem}{O{} mmmmm}{%
  \igset{theorem type=#5}%
  \ifrem@type\else
  \@@newtcolorbox[auto counter, list inside=theo,#1]{#2}{O{} d() d<>}{%
  	%enhanced,
	attach boxed title to top left={yshift*=-\tcboxedtitleheight},
  	@theoname=\detokenize{#3},
	du@theoname=\detokenize{#4},
	@labprefix=#2,
    theorem type=#5,
    #5 style,
    theorem name and number,
    title={\ig@tcb@theo@title{#3}{\thetcbcounter}},%
    IfValueTF={##2}{list entry=%
    	{\protect\numberline{\thetcbcounter}#3~:~##2}}{},%
    IfValueTF={##2}{nameref={##2},description path={##2}}{},%
    IfValueTF={##3}{code={\ig@theo@label{#2}{##3}}}{},%
	description delimiters none,
	separator sign none,
    #6,##1}%
    \fi
    \ifrem@type
    \@@newtcolorbox[auto counter, list inside=theo,#1]{#2}{O{} d() d<>}{%
	@labprefix=#2,
    remark style, 
    theorem name and number,
    title={\ig@tcb@theo@title{#3}{\thetcbcounter}
    		\IfValueTF{##2}{\enskip\mdseries\itshape({##2})}{}},%
	title style if break,
    IfValueTF={##2}{list entry=%
    	{\protect\numberline{\thetcbcounter}#3~:~##2}}{},%
    IfValueTF={##2}{nameref={##2}}{},%
    IfValueTF={##3}{code={\ig@theo@label{#2}{##3}}}{},%
	description delimiters none,
	separator sign none,
    #6,##1,
    colframe=tcbcolbacktitle
    }%
	\fi
	\ifrem@type\else
    \DeclareDocumentEnvironment{#2+}{O{} d() d<>}
    	{\csname #2\endcsname [##1,proof or solution](##2)<##3>}
		{\csname end#2\endcsname}
	\fi
	\DeclareDocumentEnvironment{#2*}{O{} d() d<>}
    	{\csname #2\endcsname [##1,theorem name](##2)<##3>}
		{\csname end#2\endcsname}
	\rem@typefalse
	}
	
\ifchapter@in@class	
	\newcounter{genthm}[chapter]
\else
	\newcounter{genthm}
\fi
\NewTColorBox[use counter=genthm, within chapter or section]{genthm*}{O{} m d() d<>}{%
	title={#2},
	IfValueTF={#3}{description path={#3}}{},
	IfValueTF={#4}{nameref={genthm:#3}}{},
	theorem style,
	theorem name,
	titled items,
	%colbacktitle=coldcol,
	#1}
\NewTColorBox[use counter=genthm, within chapter or section]{genthm}{O{} m d() d<>}{%
	IfValueTF={#2}{title={\ig@tcb@theo@title{#2}{\thetcbcounter}}}{},
	IfValueTF={#3}{nameref={#3}, description path={#3}}{},
	IfValueTF={#4}{code={\ig@theo@label{genthm}{#4}}}{},
	IfValueTF={#3}{list entry=%
    	{\protect\numberline{\thetcbcounter}#2~:~#3}}{},%
	theorem style,
	theorem name,
	titled items,
	%colbacktitle=coldcol,
	#1}
\tcbset{marge/.style={left=#1,right=#1}}	
	
%%%%%%%% Tables des théorèmes 
\def\ig@tcb@theo@title#1#2{%
	\ifdefempty{#2}{\setbox\z@=\color@hbox#1~\color@endbox}
  		{\setbox\z@=\tcb@theo@form{#1}{#2}}%
	\unhbox\z@%
}
%\def\ig@tcb@theo@title#1#2{%
%	\ifdefempty{#2}{\setbox\z@=\color@hbox#1~\color@endbox}
%  		{\setbox\z@=\color@hbox#1~#2\color@endbox}%
%	\unhbox\z@%
%}

\def\ig@addcontentsline#1#2{%
	\ifx\kvtcb@listentry\@empty\else
    	\addcontentsline{#1}{#2}{\kvtcb@listentry}%
	\fi%
}

\def\ignewtheorem{\let\tcb@addcontentsline\ig@addcontentsline%
	\let\@@newtcolorbox\NewTColorBox%
	\ig@new@tcbtheorem}

\def\igrenewtheorem{\let\@@newtcolorbox\RenewTColorBox%
  \ig@new@tcbtheorem}
  
\ProvideDocumentCommand\tableofresults%
	{O{\section*} D(){Liste des r\'esultats remarquables}}{%
		\tcblistof[#1]{theo}{#2}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% jeu de styles tcolorbox %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcbset{minimal/.style=blanker}

\tcbset{simple/.style={%
	colframe=tcbcolbacktitle,
	boxrule=.4pt,
	top=3pt,bottom=3pt,
	left=5pt,right=5pt
	}}
	
\tcbset{basic/.style={%
    colframe=tcbcolbacktitle,
    boxrule=.4pt,
	top=3pt,bottom=3pt,
	left=5pt,right=5pt,
	sharp corners
}}
\tcbset{basicthm/.style={%
	basic,
	attach boxed title to top left={xshift=3pt,yshift*=-\tcboxedtitleheight+.1pt},
	boxed title style={%
        boxsep=0pt,
        top=2pt,bottom=1pt,left=3pt,right=3pt,
        boxrule=1pt,
        colframe=pagecol
        },
}}

\tcbset{elegant/.style={%
    %colframe=tcbcolbacktitle,
    boxrule=0pt,
    bottomrule=.6pt,
    borderline north={2pt}{-2pt}{tcbcolbacktitle!70!black},
	top=3pt,bottom=3pt,
	left=5pt,right=5pt,
	sharp corners=north
}}
\tcbset{elegantthm/.style={%
	elegant,
	attach boxed title to top left={xshift=12pt,yshift*=-\tcboxedtitleheight},
	varwidth boxed title*=-3cm,
	boxed title style={interior engine=empty,
		boxsep=0pt,
		left=5pt,right=5pt,
		top=1pt, bottom=1pt,
		frame code={%
			\path [
		  		top color=tcbcolback!70!black,
					bottom color=tcbcolback!70!black,
					middle color=tcbcolback!90!black
				]
			([xshift=-2mm]frame.north west) -- 
			 ([xshift=2mm]frame.north east) [rounded corners=1mm] -- 
			  ([xshift=1mm]frame.north east) -- 
			   (frame.south east) -- (frame.south west) 
			    -- ([xshift=-1mm]frame.north west)
			      [sharp corners]-- cycle;
		}},
}}
\tcbset{rounded/.style={
	arc=5pt,
    colframe=tcbcolbacktitle,
    boxrule=-1pt,
	left=8pt,right=8pt
 }}
\tcbset{roundedthm/.style={%
	rounded,
    attach boxed title to top left={yshift=-\tcboxedtitleheight/2-1pt,xshift=3pt},
    boxed title style={%
    	arc=5pt,
        boxsep=0pt,
        top=2pt,bottom=1pt,left=6pt,right=6pt,
        boxrule=1pt,
        colframe=pagecol
        },
        bottomrule=.8pt
}}
\tcbset{uphill/.style={
    colframe=tcbcolbacktitle,
	left=5pt,right=5pt,
    arc=.2cm,
    sharp corners=uphill
 }}
\tcbset{uphillthm/.style={%
	uphill,
    attach boxed title to top left={yshift=-\tcboxedtitleheight},
    boxed title style={%
        boxsep=0pt,
        top=2pt,bottom=1pt,left=6pt,right=6pt,
        arc=.2cm,
        sharp corners=uphill
        },
        boxrule=.4pt,
 }}
\tcbset{flag/.style={%
	colframe=tcbcolbacktitle,
	left=5pt,right=5pt,
    sharp corners=north,
    arc=.2cm,
}}
\tcbset{flagthm/.style={%
	flag,
    attach boxed title to top left={yshift=-\tcboxedtitleheight, xshift=3pt},
	boxed title style={%
        boxsep=0pt,
        top=2pt,bottom=1pt,left=3pt,right=3pt,
        sharp corners=north
        },
    boxrule=.4pt,
}}

%%% Theme par defaut (basic)		
\igtheoremstyle{%
	theorem style=basicthm,
	definition style=basicthm,
	exercise style=basicthm,
	remark style=spartan
}
\igtheoremstyle{proof style={%
	blankest,
	colbacktitle=linkcol,
	attach title to upper=\par\nobreak,
	left=8pt, right=3pt, top=0pt, bottom=0pt,
	before title={\hskip-8pt},
	code={\igenum{0}{marge*}},
	after skip=2\bigskipamount
}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% style d'enumerations dans les theorem %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\let\thecurrent@counter\@gobble
\igenum{1}{marge*=0pt}
\igenum{2}{marge*=2em}
\igdeflabel{enumi}{|1|}%
\igdeco{enumi}{\deco@simple{#1}}%
\igdeflabel{enumii}{\xsquare}
\igdeco{enumii}{#1}
\igdeflabel{Equation}{\thecurrent@counter.|1|}
\let\theEquation\label@Equation
\igdeflabel{tabenum}{\small\hfill\bfseries|1|.\hskip\labelsep}
\tcbset{%
	current counter/.code={\def\thecurrent@counter{#1}}
	}
\tcbset{last color/.code=%
	{\xglobal\colorlet{lastcolbacktitle}{#1}}
}		

\newcounter{titem}
\igdeflabel{titem}{\thecurrent@counter.|1|}
\igdeco{titem}{\deco@simple{#1}}
\let\thetitem\label@titem
\let\theHtitem\theHItem
\let\unite\relax
\let\s@titem\relax
\let\l@titem\relax
\let\titem@cnt\relax
\def\titem@cmd{\par\addvspace\itemsep}
\def\step@titem{\deco@titem{\thetitem}\enskip}
\DeclareDocumentCommand\titem@{sO{}d()!d<>}{\begingroup%
	\IfBooleanTF{#1}{}%
		{\let\s@titem\step@titem}%
	\IfValueTF{#3}{\def\titem@cnt{#3}}{}%
	\IfValueTF{#3}{\def\titem@cmd{\tcbsubtitle[#2]}}{}%
	\IfValueTF{#4}
		{\stepcounter{Item}\refstepcounter{titem}%
		  \def\l@titem{\label{\ig@label@prefix:#4}}}
		{\stepcounter{titem}}%
	\titem@cmd{\s@titem\l@titem\titem@cnt}%
\endgroup}
\newif\iftitem
\tcbset{%
	titled items/.code={%
		\setcounter{titem}\z@%
		\def\unite{\titem@}%
		\igdeflabel{enumi}{|1|}
		\igdeflabel{enumii}{\xsquare}%
		\igdeflabel{enumiii}{\igdisc}%
		\igenum{1}{marge=2pc}%
		\igenum{2}{marge*=10pt}%
		\igenum{3}{marge*=20pt}%
		\igdeco{enumii}{##1}%
		\igdeco{enumiii}{##1}%
		\tcbset{subtitle style={empty,#1}}%
}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% exemples d'environement pour theoremes %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ignewtheorem[within chapter or section]{theo}
	{Th\'eor\`eme}
	{du th\'eor\`eme}
	{theorem}
	{last color=tcbcolbacktitle}	
\ignewtheorem[use counter from=theo]{theodef}
	{Th\'eor\`eme et d\'efinition}
	{du th\'eor\`eme}
	{theorem}
	{}
\ignewtheorem[use counter from=theo]{propdef}
	{Proposition et d\'efinition}
	{de la proposition}
	{theorem}
	{}
\ignewtheorem[use counter from=theo]{prop}
	{Proposition}
	{de la proposition}
	{theorem}
	{last color=tcbcolbacktitle}
\ignewtheorem[use counter from=theo]{lemm}
	{Lemme}
	{du lemme}
	{theorem}
	{}
\ignewtheorem[use counter from=theo]{ppte}
	{Propri\'et\'es}
	{des propri\'et\'es}
	{theorem}
	{title style if break, titled items}
\ignewtheorem[use counter from=theo]{coro}
	{Corollaire}
	{du corollaire}
	{theorem}
	{}
\ignewtheorem[within chapter or section]{defi}
	{D\'efinition}
	{}
	{definition}
	{}
\ignewtheorem[use counter from=defi]{voca}
	{Vocabulaire}
	{}
	{definition}
	{theorem name, titled items}
\ignewtheorem[use counter from=defi]{nota}
	{Notations}
	{}
	{definition}
	{theorem name,titled items}
\ignewtheorem[within chapter or section]{rema}
	{Remarque}
	{}
	{remark}
	{colbacktitle=warmcol!75!black}
\ignewtheorem[use counter from=rema]{remas}
	{Remarques}
	{}
	{remark}
	{colbacktitle=warmcol!75!black,titled items}
\ignewtheorem[use counter from=rema]{remap}
	{Remarques pratiques}
	{}
	{remark}
	{colbacktitle=warmcol!75!black,titled items}
\ignewtheorem[within chapter or section]{exem}
	{Exemples}
	{}
	{remark}
	{colbacktitle=warmcol!90,titled items}
\ignewtheorem[use counter from=exem]{exemf}
	{Exemples fondamentaux}
	{}
	{remark}
	{colbacktitle=warmcol!90,titled items}
\ignewtheorem[use counter from=exem]{exema}
	{Exemple d'application}
	{}
	{remark}
	{colbacktitle=warmcol!90,titled items}
\ignewtheorem[use counter from=exem]{exemp}
	{Exemple pratique}
	{}
	{remark}
	{colbacktitle=warmcol!90,titled items}

\ignewtheorem[within chapter or section]{prob}
	{Probl\`eme}
	{du probl\`eme}
	{exercise}
	{}
\ignewtheorem[no counter]{demo}
	{D\'emonstration}
	{}
	{proof}
	{titled items, current counter=\@gobble}
\ignewtheorem[within chapter or section]{float}
	{Figure}
	{}
	{remark}
	{float, colbacktitle=coldcol!90, halign title=flush center}
\tcbset{floatplacement=tbp}

\ifserie
 	\newcounter{igexer}
    \ignewtheorem[use counter=igexer]{exer}
    	{Exercice}
    	{de l'exercice}
    	{exercise}
    	{colbacktitle=warmcol}
\else
	\ignewtheorem[within chapter or section]{exer}
	{Exercice}
	{de l'exercice}
	{exercise}
	{colbacktitle=importantcol}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% styles pour les titres de sections %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	   
\igdeflabel{chapter}{|1|}
\igdeflabel{section}{|I|}
\igdeflabel{subsection}{|S|.|1|}	   
	   
\tcbset{chapter style/.style={}}
\tikzset{chapter label style/.style={}}
\tcbset{section style/.style={}}
\tikzset{section label style/.style={}}

\igset{sections/.is family, sections,
	chapter style/.code={\tcbset{chapter style/.style={#1}}},
	chapter label style/.code={\tikzset{chapter label style/.style={#1}}},
	chapter label decoration/.code={\def\chapter@label@deco{#1}},
	section style/.code={\tcbset{section style/.style={#1}}},
	section label style/.code={\tikzset{section label style/.style={#1}}},
	subsection label style/.code={\tikzset{subsection label style/.style={#1}}},
	chapter label anchor/.store in=\ig@chapter@anchor,
	chapter label anchor=north east,
	section label anchor/.store in=\ig@section@anchor,
	section label anchor=west,
}
\igdeflabel{chapter}{\oldstylenums{|1|}}
\igset[sections]{%
chapter style={%
	colback=bgcol,
	coltext=fgcol,
	boxrule=0pt,
	lowerbox=ignored,
   },
chapter label style={},
section style={%
    boxrule=0pt,
    coltext=fgcol,
    colback=bgcol,
    fontupper=\itshape,
    },
section label style={},
subsection label style={}
}
\ifchapter@in@class
\titleformat{name=\chapter}[display]
     {\normalfont\huge\scshape}
     {}
     {0pt}
     {%
       \begin{tcolorbox}[
				 enhanced,
         chapter style,
         overlay={
           \node (chapter label) [chapter label style] 
           at (frame.\ig@chapter@anchor)
           {\label@chapter};
					 \csuse{chapter@label@deco}
         } 
       ]
      #1
       \end{tcolorbox}%
     }
\titleformat{name=\chapter,numberless}[display]
     {\normalfont\huge}
     {}
     {0pt}
     {%
       \begin{tcolorbox}[chapter style]
       \filright #1
       \end{tcolorbox}%
     }
%\titlespacing*{\chapter}{\z@}{-2cm}{*-2}
\fi
\titleformat{\section}[block]
     {\sffamily\Large\scshape}
     {}
     {0pt}
     {%
       \begin{tcolorbox}[
         section style,
         overlay={
           \node[section label style] 
           at (frame.\ig@section@anchor)
           {\label@section};
         },
         force nobeforeafter
       ]
       \vphantom{(}#1
       \end{tcolorbox}%
     }
\titleformat{name=\section,numberless}
     {\sffamily\Large\scshape}
     {}
     {0pt}
     {%
       \begin{tcolorbox}[%
       		section style,
			force nobeforeafter
		]
       \vphantom{(}#1
       \end{tcolorbox}%
     }
\titleformat{\subsection}
	{\sffamily\large\scshape} 
	{\tikz[baseline=(S.base)]\node(S)[subsection label style] {\label@subsection};}
	{3pt}
	{\itshape#1}

\def\fakebox#1{#1}
%%%% Decoration des maths. La base est definie dans igmath.sty 
\tcbset{math@box/.style={}}
\igset{%
	math box style/.code={\tcbset{math@box/.style={%
		reset, enhanced,
		nobeforeafter,
    title hidden,
    tcbox raise base,
		left=3pt,right=3pt,top=2pt,bottom=2pt,
		boxrule=.4pt,
    colback=bgcol!90,
    colupper=fgcol,
		#1}
	}}}
\igset{math box style={}}
\newtcbox{\rslt@box}{math@box}
\igdeco{formule}{\rslt@box{#1}}
\igdeco{formula}{\rslt@box{#1}}
\igdeco{result}{\rslt@box{#1}}


\endinput
